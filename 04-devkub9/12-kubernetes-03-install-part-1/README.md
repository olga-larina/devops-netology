# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* база данных должна быть отказоустойчивой (не менее трех копий, master-slave) и потребляет около 4 ГБ ОЗУ в работе;
* кэш должен быть аналогично отказоустойчивый, более трех копий, потребление: 4 ГБ ОЗУ, 1 ядро;
* фронтенд обрабатывает внешние запросы быстро, отдавая статику: не более 50 МБ ОЗУ на каждый экземпляр;
* бекенду требуется больше: порядка 600 МБ ОЗУ и по 1 ядру на копию.

Требования: опишите, сколько нод в кластере и сколько ресурсов (ядра, ОЗУ, диск) нужно для запуска приложения. Расчет вести из необходимости запуска 5 копий фронтенда и 10 копий бекенда, база и кеш.

### Ответ

##### Master-ноды.  
1 нода может справиться с нагрузкой, но такое решение не будет отказоустойчивым. Поэтому лучше запустить несколько control-plane нод (нечётное 
количество во избежание split brain).

|                                         | CPU (ядра) на 1 ноду | ОЗУ (Гб) на 1 ноду | Диск (Гб) на 1 ноду | Ноды |
|-----------------------------------------|----------------------|--------------------|---------------------|------|
| Минимально                              | 2                    | 2                  | 50                  | 1    |
| Для обеспечения отказоустойчивости (x2) | 4                    | 4                  | 100                 | 3    |

Таким образом, будет 3 control plane ноды каждая по 4 CPU, 4 Гб ОЗУ, 100 Гб диска.

##### Рабочие ноды.  
В качестве коэффициента для обеспечения отказоустойчивости возьмём 1.5. Количество нод берём по количеству необходимых копий.

|             | CPU на 1 ноду <br/>(min / с учётом коэф-та x1.5) | ОЗУ на 1 ноду <br/>(min / с учётом коэф-та x1.5) | Диск на 1 ноду <br/>(min / с учётом коэф-та x1.5) | Кол-во нод |
|-------------|--------------------------------------------------|--------------------------------------------------|---------------------------------------------------|------------|
| Минимально  | 1 (1.5)                                          | 1 Гб (1.5 Гб)                                    | 100 Гб (150 Гб)                                   |            |
| БД (master) | 1 (1.5)                                          | 4 Гб (6 Гб)                                      | 30 Гб (45 Гб)                                     | 3          |
| БД (slave)  | 1 (1.5)                                          | 4 Гб (6 Гб)                                      | 30 Гб (45 Гб)                                     | 3          |
| Кэш         | 1 (1.5)                                          | 4 Гб (6 Гб)                                      | 10 Гб (15 Гб)                                     | 3          |
| Фронтенд    | 0.1 (0.15)                                       | 50 Мб (75 Мб)                                    | 1 Гб (1.5 Гб)                                     | 5          |
| Бекенд      | 1 (1.5)                                          | 600 Мб (900 Мб)                                  | 3 Гб (4.5 Гб)                                     | 10         |

В качестве итогового количества нод выберем максимально необходимое количество копий, т.е. **10**. Получается, что все копии составляющих рабочих нод будут развёрнуты на разных нодах, 
но на одной ноде может быть развёрнуто несколько составляющих. Т.е. все копии бекенда на разных нодах, но вместе с бекендом может быть развёрнута 1 копия кэша, 1 копия фронтенда, 1 копия БД slave и т.д.  

Максимальное количество ресурсов (с учётом коэффициента x1.5) **для 1 рабочей ноды** (исходя из предположения, что там может быть развёрнуто по 1 копии каждой составляющей):  
CPU = 1.5 (min) + 1.5 (БД master или slave) + 1.5 (кэш) + 0.15 (фронтенд) + 1.5 (бекенд) = 6.15  
ОЗУ = 1536 Мб (min) + 6144 Мб (БД master или slave) + 6144 Мб (кэш) + 75 Мб (фронтенд) + 900 Мб (бекенд) = 14799 Мб ~ 14.5 Гб  
Диск = 150 Гб (min) + 45 Гб (БД master или slave) + 15 Гб (кэш) + 1.5 Гб (фронтенд) + 4.5 Гб (бекенд) = 216 Гб